@page "/"
@using Blazored.LocalStorage
@using Resume.WASM.MoneyForcaster.Models
@inject ILocalStorageService localStorage

<PageTitle>Index</PageTitle>
<MudText>@Bills?.Count()</MudText>
<MudButton OnClick="(()=> AddBill())">Add Bill</MudButton>


@code {

    public List<Bill> Bills = new List<Bill>();
    protected override async Task OnInitializedAsync()
    {
        var bills = await localStorage.GetItemAsync<List<Bill>>("bills");
        if (bills == null) await localStorage.SetItemAsync<List<Bill>>("bills", Bills);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        Bills = await localStorage.GetItemAsync<List<Bill>>("bills");
        if (firstRender) this.StateHasChanged();
    }

    private async Task AddBill()
    {
        Bills.Add(new Bill() { Name = "bullshit" });
        await localStorage.SetItemAsync<List<Bill>>("bills", Bills);

    }
}
